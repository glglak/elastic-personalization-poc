<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <!-- Background -->
  <rect width="800" height="600" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="400" y="40" font-family="Arial" font-size="22" text-anchor="middle" font-weight="bold">Content Personalization Flow</text>

  <!-- Starting point -->
  <circle cx="400" cy="100" r="20" fill="#4285F4" />
  <text x="400" y="105" font-family="Arial" font-size="14" text-anchor="middle" fill="white">Start</text>
  
  <!-- User Profile Collection -->
  <rect x="300" y="150" width="200" height="60" rx="10" ry="10" fill="#BBDEFB" stroke="#2196F3" stroke-width="2" />
  <text x="400" y="175" font-family="Arial" font-size="16" text-anchor="middle" fill="#333">1. User Profile Collection</text>
  <text x="400" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">Preferences & Interests</text>
  
  <!-- User Interactions Collection -->
  <rect x="300" y="240" width="200" height="60" rx="10" ry="10" fill="#C8E6C9" stroke="#4CAF50" stroke-width="2" />
  <text x="400" y="265" font-family="Arial" font-size="16" text-anchor="middle" fill="#333">2. User Interactions</text>
  <text x="400" y="285" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">Shares, Likes, Comments, Follows</text>
  
  <!-- Weight Calculation -->
  <rect x="300" y="330" width="200" height="60" rx="10" ry="10" fill="#FFE0B2" stroke="#FF9800" stroke-width="2" />
  <text x="400" y="355" font-family="Arial" font-size="16" text-anchor="middle" fill="#333">3. Weight Calculation</text>
  <text x="400" y="375" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">Apply Weights to Interactions</text>
  
  <!-- Elasticsearch Query Generation -->
  <rect x="300" y="420" width="200" height="60" rx="10" ry="10" fill="#E1BEE7" stroke="#9C27B0" stroke-width="2" />
  <text x="400" y="445" font-family="Arial" font-size="16" text-anchor="middle" fill="#333">4. Query Generation</text>
  <text x="400" y="465" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">Elasticsearch Function Scoring</text>
  
  <!-- Content Retrieval -->
  <rect x="300" y="510" width="200" height="60" rx="10" ry="10" fill="#FFCDD2" stroke="#F44336" stroke-width="2" />
  <text x="400" y="535" font-family="Arial" font-size="16" text-anchor="middle" fill="#333">5. Personalized Feed</text>
  <text x="400" y="555" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">Scored & Ranked Content</text>
  
  <!-- End of flow -->
  <path d="M400,570 L400,580 L410,580 L400,600 L390,580 L400,580" fill="#F44336" />
  
  <!-- Arrow connections -->
  <path d="M400,120 L400,150" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />
  <path d="M400,210 L400,240" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />
  <path d="M400,300 L400,330" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />
  <path d="M400,390 L400,420" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />
  <path d="M400,480 L400,510" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Detailed elements for user profile collection -->
  <rect x="550" y="150" width="200" height="100" rx="5" ry="5" fill="#E3F2FD" stroke="#2196F3" stroke-width="1" />
  <text x="650" y="170" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">User Profile Details:</text>
  <text x="560" y="190" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Preferences: 2.0 weight</text>
  <text x="560" y="210" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Interests: 1.5 weight</text>
  <text x="560" y="230" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Categories & Tags Matching</text>
  
  <!-- Detailed elements for User Interactions -->
  <rect x="550" y="260" width="200" height="120" rx="5" ry="5" fill="#E8F5E9" stroke="#4CAF50" stroke-width="1" />
  <text x="650" y="280" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">Interaction Weights:</text>
  <text x="560" y="300" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Share: 5.0 (highest)</text>
  <text x="560" y="320" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Comment: 4.0</text>
  <text x="560" y="340" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Follow: 4.5</text>
  <text x="560" y="360" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Like: 3.0</text>
  
  <!-- Detailed elements for query generation -->
  <rect x="50" y="420" width="200" height="120" rx="5" ry="5" fill="#F3E5F5" stroke="#9C27B0" stroke-width="1" />
  <text x="150" y="440" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">Elasticsearch Query:</text>
  <text x="60" y="460" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Base Query: Match preferences</text>
  <text x="60" y="480" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Function Scoring: Apply boosts</text>
  <text x="60" y="500" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Creator Boost: For followed users</text>
  <text x="60" y="520" font-family="Arial" font-size="12" text-anchor="start" fill="#333">• Recency Boost: Newer content</text>
  
  <!-- Connection lines to detailed elements -->
  <path d="M500,180 L550,180" stroke="#2196F3" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#blueArrow)" />
  <path d="M500,270 L550,290" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#greenArrow)" />
  <path d="M300,450 L250,450" stroke="#9C27B0" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#purpleArrow)" />
  
  <!-- Arrow definitions -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666" />
    </marker>
    <marker id="blueArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
    </marker>
    <marker id="greenArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4CAF50" />
    </marker>
    <marker id="purpleArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
    </marker>
  </defs>
</svg>
